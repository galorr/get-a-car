<div class="side-nav" [class.expanded]="isExpanded()">
  <!-- Side Nav Toggle Button -->
  <div class="side-nav-toggle" (click)="toggleExpand()">
    <div class="toggle-icon">
      {{ isExpanded() ? '>' : '<' }}
    </div>
  </div>

  <!-- Side Nav Content -->
  <div class="side-nav-content">
    <!-- Navigation Tabs -->
    <div class="nav-tabs">
      <div class="tab"
           [class.active]="activeSection() === 'registration'"
           (click)="setActiveSection('registration')">
        <span class="tab-icon material-icons" [class.active-icon]="activeSection() === 'registration'">person</span>
        @if (isExpanded()) {
          <span class="tab-label">Registration</span>
        }
        @if (activeSection() === 'registration') {
          <div class="active-indicator"></div>
        }
      </div>
      <div class="tab"
           [class.active]="activeSection() === 'alerts'"
           (click)="setActiveSection('alerts')">
        <span class="tab-icon material-icons" [class.active-icon]="activeSection() === 'alerts'">notifications</span>
        @if (isExpanded()) {
          <span class="tab-label">Alerts</span>
        }
        @if (activeSection() === 'alerts') {
          <div class="active-indicator"></div>
        }
      </div>
      <div class="tab"
           [class.active]="activeSection() === 'settings'"
           (click)="setActiveSection('settings')">
        <span class="tab-icon material-icons" [class.active-icon]="activeSection() === 'settings'">settings</span>
        @if (isExpanded()) {
          <span class="tab-label">Settings</span>
        }
        @if (activeSection() === 'settings') {
          <div class="active-indicator"></div>
        }
      </div>
    </div>

    <!-- Section Content -->
    @if (isExpanded()) {
      <div class="section-content">
        <!-- Registration Section -->
        @if (activeSection() === 'registration') {
          <div class="section">
            <h3>Car Registration</h3>

            <!-- Success message -->
            @if (submissionSuccess()) {
              <div class="success-message">
                <p>Registration successful! You are now tracking this car.</p>
              </div>
            }

            <!-- Error message -->
            @if (submissionError()) {
              <div class="error-message">
                <p>{{ submissionError() }}</p>
              </div>
            }

            <!-- Registration form -->
            @if (!submissionSuccess()) {
              <form [formGroup]="registrationForm" (ngSubmit)="onSubmit()">
                <div class="form-group">
                  <label for="name">Your Name</label>
                  <input type="text" id="name" formControlName="name">
                  @if (formErrors()['name']) {
                    <div class="error">{{ formErrors()['name'] }}</div>
                  }
                </div>

                <div class="form-group">
                  <label for="email">Email</label>
                  <input type="email" id="email" formControlName="email">
                  @if (formErrors()['email']) {
                    <div class="error">{{ formErrors()['email'] }}</div>
                  }
                </div>

                <div class="form-group">
                  <label for="phone">Phone (optional)</label>
                  <input type="tel" id="phone" formControlName="phone">
                </div>

                <div class="form-group">
                  <label for="address">Address</label>
                  <input type="text" id="address" formControlName="address">
                  @if (formErrors()['address']) {
                    <div class="error">{{ formErrors()['address'] }}</div>
                  }
                </div>

                <div class="form-group">
                  <label for="license">Driver's License Number</label>
                  <input type="text" id="license" formControlName="license" placeholder="e.g., DL12345678">
                  @if (formErrors()['license']) {
                    <div class="error">{{ formErrors()['license'] }}</div>
                  }
                </div>

                <div class="form-group">
                  <label for="preferredCarType">Preferred Car Type/Model</label>
                  <select id="preferredCarType" formControlName="preferredCarType" class="form-select">
                    <option value="">Select a car type</option>
                    <option value="economy">Economy</option>
                    <option value="compact">Compact</option>
                    <option value="midsize">Midsize Sedan</option>
                    <option value="fullsize">Full-size Sedan</option>
                    <option value="suv-small">Small SUV</option>
                    <option value="suv-midsize">Midsize SUV</option>
                    <option value="suv-large">Large SUV</option>
                    <option value="truck">Pickup Truck</option>
                    <option value="van">Minivan</option>
                    <option value="luxury">Luxury</option>
                    <option value="convertible">Convertible</option>
                    <option value="hybrid">Hybrid/Electric</option>
                  </select>
                  @if (formErrors()['preferredCarType']) {
                    <div class="error">{{ formErrors()['preferredCarType'] }}</div>
                  }
                </div>

                <div class="form-group">
                  <label for="rentalDuration">Rental Duration (days)</label>
                  <input type="number" id="rentalDuration" formControlName="rentalDuration" min="1" placeholder="e.g., 7">
                  @if (formErrors()['rentalDuration']) {
                    <div class="error">{{ formErrors()['rentalDuration'] }}</div>
                  }
                </div>

                <div class="form-group">
                  <label for="pickupLocation">Pickup Location</label>
                  <select id="pickupLocation" formControlName="pickupLocation" class="form-select">
                    <option value="">Select pickup location</option>
                    <option value="airport">Airport Terminal</option>
                    <option value="downtown">Downtown Office</option>
                    <option value="north">North Branch</option>
                    <option value="south">South Branch</option>
                    <option value="east">East Branch</option>
                    <option value="west">West Branch</option>
                    <option value="hotel">Hotel Delivery</option>
                    <option value="custom">Custom Address</option>
                  </select>
                  @if (formErrors()['pickupLocation']) {
                    <div class="error">{{ formErrors()['pickupLocation'] }}</div>
                  }
                </div>

                @if (hasSelectedCar()) {
                  <div class="form-group">
                    <label>Selected Car</label>
                    <div class="selected-car-info">
                      <p><strong>{{ selectedCar()?.name }}</strong></p>
                      <p>ID: {{ selectedCar()?.id }}</p>
                      <p>Status: {{ selectedCar()?.status }}</p>
                    </div>
                  </div>
                }

                <div class="form-actions">
                  <button type="submit"
                          [disabled]="!registrationForm.valid || !hasSelectedCar() || isSubmitting()">
                    {{ isSubmitting() ? 'Registering...' : 'Register to Track' }}
                  </button>
                </div>
              </form>
            }

            <!-- No car selected message -->
            @if (!hasSelectedCar() && !submissionSuccess()) {
              <div class="no-car-selected">
                <p>Please select a car from the map or grid to register for tracking.</p>
              </div>
            }
          </div>
        }

        <!-- Alerts Section -->
        @if (activeSection() === 'alerts') {
          <div class="section">
            <h3>Alerts</h3>
            <div class="alerts-content">
              <div class="alert-list">
                <h4>Recent Alerts</h4>

                <div class="alert-item alert-warning">
                  <div class="alert-icon">
                    <span class="material-icons">event</span>
                  </div>
                  <div class="alert-details">
                    <div class="alert-title">Upcoming Rental Reminder</div>
                    <div class="alert-message">Your rental for Midsize Sedan (ID: RS-2023) starts tomorrow at 9:00 AM.</div>
                    <div class="alert-time">1 hour ago</div>
                  </div>
                </div>

                <div class="alert-item alert-info">
                  <div class="alert-icon">
                    <span class="material-icons">build</span>
                  </div>
                  <div class="alert-details">
                    <div class="alert-title">Car Maintenance Alert</div>
                    <div class="alert-message">Your current rental vehicle is scheduled for maintenance on 08/15. Please contact us to arrange an exchange.</div>
                    <div class="alert-time">3 hours ago</div>
                  </div>
                </div>

                <div class="alert-item alert-success">
                  <div class="alert-icon">
                    <span class="material-icons">local_offer</span>
                  </div>
                  <div class="alert-details">
                    <div class="alert-title">Special Offer Available</div>
                    <div class="alert-message">Weekend special: 20% off on SUV rentals. Use code WEEKEND20 at checkout.</div>
                    <div class="alert-time">Yesterday</div>
                  </div>
                </div>

                <div class="alert-item alert-info">
                  <div class="alert-icon">
                    <span class="material-icons">update</span>
                  </div>
                  <div class="alert-details">
                    <div class="alert-title">Rental Status Update</div>
                    <div class="alert-message">Your reservation #R-78945 has been confirmed. Pickup ready at Downtown Office.</div>
                    <div class="alert-time">2 days ago</div>
                  </div>
                </div>
              </div>

              <div class="alert-settings">
                <h4>Alert Settings</h4>
                <div class="alert-option">
                  <label>
                    <input type="checkbox" checked> Upcoming rental reminders
                  </label>
                </div>
                <div class="alert-option">
                  <label>
                    <input type="checkbox" checked> Maintenance alerts
                  </label>
                </div>
                <div class="alert-option">
                  <label>
                    <input type="checkbox" checked> Special offers & discounts
                  </label>
                </div>
                <div class="alert-option">
                  <label>
                    <input type="checkbox" checked> Rental status updates
                  </label>
                </div>
                <div class="alert-option">
                  <label>
                    <input type="checkbox" checked> Payment reminders
                  </label>
                </div>
                <div class="alert-option">
                  <label>
                    <input type="checkbox"> Low fuel warnings
                  </label>
                </div>
                <div class="alert-option">
                  <label>
                    <input type="checkbox"> Traffic alerts for rental area
                  </label>
                </div>
                <div class="alert-option">
                  <label>
                    <input type="checkbox" checked> Email notifications
                  </label>
                </div>
                <div class="alert-option">
                  <label>
                    <input type="checkbox" checked> Push notifications
                  </label>
                </div>
                <div class="alert-option">
                  <label>
                    <input type="checkbox"> SMS notifications
                  </label>
                </div>
              </div>
            </div>
          </div>
        }

        <!-- Settings Section -->
        @if (activeSection() === 'settings') {
          <div class="section">
            <h3>Settings</h3>
            <div class="settings-content">
              <div class="setting-group">
                <h4>Rental Preferences</h4>
                <div class="setting-option">
                  <label>Default Rental Duration</label>
                  <select class="form-select">
                    <option value="1">1 day</option>
                    <option value="2">2 days</option>
                    <option value="3">3 days</option>
                    <option value="5">5 days</option>
                    <option value="7" selected>7 days</option>
                    <option value="14">14 days</option>
                    <option value="30">30 days</option>
                  </select>
                </div>
                <div class="setting-option">
                  <label>Preferred Car Categories</label>
                  <div class="checkbox-group">
                    <label><input type="checkbox" checked> Economy</label>
                    <label><input type="checkbox" checked> Compact</label>
                    <label><input type="checkbox" checked> Midsize</label>
                    <label><input type="checkbox"> Full-size</label>
                    <label><input type="checkbox" checked> SUV</label>
                    <label><input type="checkbox"> Luxury</label>
                    <label><input type="checkbox"> Convertible</label>
                    <label><input type="checkbox"> Hybrid/Electric</label>
                  </div>
                </div>
                <div class="setting-option">
                  <label>Default Pickup Location</label>
                  <select class="form-select">
                    <option value="airport" selected>Airport Terminal</option>
                    <option value="downtown">Downtown Office</option>
                    <option value="north">North Branch</option>
                    <option value="south">South Branch</option>
                    <option value="east">East Branch</option>
                    <option value="west">West Branch</option>
                    <option value="hotel">Hotel Delivery</option>
                  </select>
                </div>
              </div>

              <div class="setting-group">
                <h4>Map Settings</h4>
                <div class="setting-option">
                  <label>
                    <input type="checkbox" checked> Show available cars only
                  </label>
                </div>
                <div class="setting-option">
                  <label>
                    <input type="checkbox" checked> Show rental locations
                  </label>
                </div>
                <div class="setting-option">
                  <label>
                    <input type="checkbox"> Show traffic data
                  </label>
                </div>
                <div class="setting-option">
                  <label>
                    <input type="checkbox" checked> Show car details on hover
                  </label>
                </div>
              </div>

              <div class="setting-group">
                <h4>Notification Preferences</h4>
                <div class="setting-option">
                  <label>
                    <input type="checkbox" checked> Rental reminders (24h before)
                  </label>
                </div>
                <div class="setting-option">
                  <label>
                    <input type="checkbox" checked> Return reminders (24h before)
                  </label>
                </div>
                <div class="setting-option">
                  <label>
                    <input type="checkbox" checked> Special offers & promotions
                  </label>
                </div>
                <div class="setting-option">
                  <label>
                    <input type="checkbox" checked> Rental status updates
                  </label>
                </div>
                <div class="setting-option">
                  <label>Notification Method</label>
                  <select class="form-select">
                    <option value="email" selected>Email</option>
                    <option value="push">Push Notifications</option>
                    <option value="sms">SMS</option>
                    <option value="all">All Methods</option>
                  </select>
                </div>
              </div>

              <div class="setting-group">
                <h4>Payment Methods</h4>
                <div class="payment-method">
                  <div class="payment-icon">
                    <span class="material-icons">credit_card</span>
                  </div>
                  <div class="payment-details">
                    <div>Visa ending in 4242</div>
                    <div class="payment-expiry">Expires 12/25</div>
                  </div>
                  <div class="payment-actions">
                    <button class="action-button">
                      <span class="material-icons">edit</span>
                    </button>
                    <button class="action-button">
                      <span class="material-icons">delete</span>
                    </button>
                  </div>
                </div>
                <button class="add-payment-button">
                  <span class="material-icons">add</span>
                  Add Payment Method
                </button>
              </div>

              <div class="setting-group">
                <h4>Display Settings</h4>
                <div class="setting-option">
                  <label>Theme</label>
                  <div class="theme-selector">
                    <div class="theme-option" [class.active]="true">
                      <span class="theme-color light-theme"></span>
                      <span class="theme-label">Light</span>
                    </div>
                    <div class="theme-option">
                      <span class="theme-color dark-theme"></span>
                      <span class="theme-label">Dark</span>
                    </div>
                    <div class="theme-option">
                      <span class="theme-color blue-theme"></span>
                      <span class="theme-label">Blue</span>
                    </div>
                  </div>
                </div>
                <div class="setting-option">
                  <label>Language</label>
                  <select class="form-select">
                    <option value="en" selected>English</option>
                    <option value="es">Spanish</option>
                    <option value="fr">French</option>
                    <option value="de">German</option>
                    <option value="zh">Chinese</option>
                  </select>
                </div>
              </div>

              <div class="setting-group">
                <h4>Account Settings</h4>
                <button class="settings-button">
                  <span class="material-icons">person</span>
                  Manage Profile
                </button>
                <button class="settings-button">
                  <span class="material-icons">history</span>
                  Rental History
                </button>
                <button class="settings-button">
                  <span class="material-icons">security</span>
                  Privacy & Security
                </button>
              </div>
            </div>
          </div>
        }
      </div>
    }
  </div>
</div>
